var status = 0;
var icon = "#fUI/Basic.img/BtMin2/normal/0#";
var iconX = "#fEffect/CharacterEff/1112905/0/1#";
var iconStar = "#fEffect/CharacterEff/1112904/2/1#";
var icon1 = "#fEffect/CharacterEff/1042176/0/0#";
var iconHR = "#fEffect/CharacterEff/1082565/0/0#"
var icon2 = "#fEffect/CharacterEff/1082565/2/0#";
var icon3 = "#fEffect/CharacterEff/1082565/4/0#";
var icon4 = "#fUI/UIWindow2.img/QuestAlarm/BtQ/normal/0#";
var giftContent = Array(
 Array("勳章神秘鐵砧",   220, Array(
        Array(5062402, 1)
    )),
 Array("神秘力量勳章(含三枚)",   300, Array(
        Array(2430026, 1)
    )),
 Array("神秘力量升級材料(1)",   30, Array(
        Array(1712000, 1)
    )),
 Array("戴米安機器人兌換卷(三潛)",   850, Array(
        Array(2435482, 1)
    )),
 Array("阿麗莎機器人兌換卷(三潛)",   850, Array(
        Array(2435483, 1)
    )),
 Array("隱月(女)兌換卷(三潛)",   850, Array(
        Array(2432342, 1)
    )),
 Array("史烏機器人兌換卷(三潛)",   850, Array(
        Array(2433167, 1)
    )),
 Array("殺人鯨機器人兌換卷(三潛)",   850, Array(
        Array(2433339, 1)
    )),
 //Array("完美飾品防具卷軸 X 1", 40, Array(
       // Array(2616051, 1)
    //)),
 //Array("完美飾品防具卷軸 X 10", 400, Array(
       // Array(2616051, 10)
    //)),
 Array("專屬紫金楓葉羽毛 X 1", 800, Array(
        Array(2570002, 1)
    )),

 Array("17星星之力強化卷",   50, Array(
        Array(2049371, 1)
    )),
 Array("18星星之力強化卷",   120, Array(
        Array(2049387, 1)
    )),
 Array("19星星之力強化卷",   200, Array(
        Array(2049388, 1)
    )),
 Array("20星星之力強化卷",   400, Array(
        Array(2049389, 1)
    )),
  Array("瑪瑙戒指禮包1",   80, Array(
        Array(2433444, 1)
    )),
  Array("瑪瑙戒指禮包2",   120, Array(
        Array(2435087, 1)
    )),
  Array("瑪瑙戒指禮包3",   250, Array(
        Array(2434174, 1)
    )),
  Array("彩色楓葉",   550, Array(
        Array(4032733, 1)
    )),
 Array("超越套裝",   500, Array(
        Array(2431303, 1)
    )),
  Array("閃炫方塊 X 50",   900, Array(
        Array(5062024, 50)
    )),
  Array("核心寶石 X 100",   40, Array(
        Array(2435719, 100)
    )),
  Array("探險之黑暗暴擊戒指",   200, Array(
        Array(1113069, 1)
    )),
 Array("遺忘之神話耳環",   300, Array(
        Array(1032219, 1)
    )),
  Array("法弗納武器箱（自選)",   300, Array(
        Array(2431509, 1)
    )),
  Array("法弗納防具箱（自選)",   500, Array(
        Array(2431988, 1)
    )),
    Array("埃蘇武器箱（自選)",   700, Array(
        Array(2434340, 1)
    )),
    Array("諾巴劍士套裝",   100, Array(
       Array(1132169, 1),
        Array(1102476, 1),
        Array(1072737, 1)
    )), 
    Array("諾巴魔法師套裝",   100, Array(
        Array(1132170, 1),
        Array(1102477, 1),
        Array(1072738, 1)
    )), 
    Array("諾巴弓箭手套裝",   100, Array(
        Array(1132171, 1),
        Array(1102478, 1),
        Array(1072739, 1)
    )),
    Array("諾巴盜賊套裝",     200, Array(
        Array(1132172, 1),
        Array(1102479, 1),
        Array(1072740, 1)
    )),
    Array("諾巴海盜套裝",  100, Array(
        Array(1132173, 1),
        Array(1102480, 1),
        Array(1072741, 1)
    )),
     Array("8週年點點紅",   95, Array(
        Array(1012319, 1)
    )),
    Array("進擊巨人勳章",   120, Array(
        Array(1142788, 1)
    )),
    Array("人類最強勳章",   150, Array(
        Array(1142789, 1)
    )),
    // Array("本F最強套裝：漩渦套裝",   500, Array(
      //  Array(1003976, 1),
      //  Array(1102623, 1),
      //  Array(1082556, 1),
     //   Array(1052669, 1),
     //   Array(1072870, 1),
     //   Array(2610003, 10),
    //    Array(-1, 150000)
   // )),
    //  Array("最高級培羅德首飾",   300, Array(
     //   Array(1113075, 1),
     //   Array(1032223, 1),
     //   Array(1122267, 1),
      //  Array(1132246, 1),
      //  Array(-1, 50000)
   // ))
   Array("古董品圖騰套裝",   500, Array(
        Array(1202173, 1),
        Array(1202174, 1),
        Array(1202175, 1)
    )), 
   //Array("殺人鯨的徽章(解除狀態加5%G)",   300, Array(
   //     Array(1182158, 1)
    //)), 
    //Array("MX-131徽章(加一次段數)",   300, Array(
    //    Array(1182136, 1)
    //)), 
    Array("高級次元手套",   100, Array(
        Array(1082489, 1)
    )), 

    Array("恐怖鬼娃的傷口（50G）",   200, Array(
        Array(1012174, 1)
    )), 
    Array("星星X5000",   30, Array(
        Array(4001839, 5000)
    )), 
    Array("咒語痕跡X5000",   20, Array(
        Array(4001832, 5000)
    )), 
    Array("暴風手套攻擊卷X10",   50, Array(
        Array(2040874, 10)
    )), 
    Array("暴風手套魔力卷X10",   50, Array(
        Array(2040875, 10)
    )), 

     Array("狂狼勇士祝福戒指",   350, Array(
        Array(1113020, 1)
    )), 
    Array("黑龍傳說指環(每個角色限購一次)",   300, Array(
        Array(1113084, 1)
    )), 
    Array("獨眼巨人之眼Lv.3",   100, Array(
        Array(1022226, 1)
    )),
    Array("阿麗莎之光輝",     400, Array(
        Array(1382235, 1)
    )),
    Array("進階貝倫頭盔",  120, Array(
        Array(1003722, 1)
    )),
    Array("解放的凱瑟利安",  400, Array(
        Array(1402180, 1)
    )),
    Array("校長織田徽章",  80, Array(
        Array(1162035, 1)
    )),
    Array("真·本多忠勝圖騰",  150, Array(
        Array(1202090, 1)
    )),
    Array("真·上杉謙信圖騰",  150, Array(
        Array(1202091, 1)
    )),
    Array("真·真田幸村圖騰",  150, Array(
        Array(1202089, 1)
    )),
    Array("戰鬥機器人(女)",  300, Array(
        Array(1662072, 1)
    )),
    Array("戰鬥機器人(男)",  300, Array(
        Array(1662073, 1)
    )),
    Array("南哈特機器人(男)",  350, Array(
        Array(1662064, 1)
    )),
    Array("伊爾卡機器人(男)",  350, Array(
        Array(1662065, 1)
    )),
    Array("西格諾斯機器人(女)",  350, Array(
        Array(1662066, 1)
    )),
    Array("戴米安機器人",  400, Array(
        Array(1662088, 1)
    )),
    Array("阿麗莎機器人",  400, Array(
        Array(1662089, 1)
    )),
    Array("史烏機器人",  400, Array(
        Array(1662092, 1)
    )),
    Array("殺人鯨機器人",  400, Array(
        Array(1662093, 1)
    )),
    Array("露希妲機器人",  450, Array(
        Array(1662111, 1)
    )),
    Array("未來機器人(男)",  300, Array(
        Array(1662033, 1)
    )),
    Array("未來機器人(女)",  300, Array(
        Array(1662034, 1)
    )),
    Array("極真鋰心臟",  300, Array(
        Array(1672027, 1)
    )),
    Array("V卷軸自選（1張）",  50, Array(
        Array(2435413, 1)
    )),
    Array("X卷軸自選（1張）",  18, Array(
        Array(2434666, 1)
    )),
    Array("X卷軸自選（10張）",  180, Array(
        Array(2431042, 1)
    )),
    Array("驚人武器卷軸自選（1張）",  10, Array(
        Array(2431744, 1)
    )),
    Array("未來機器人心臟 : 最高級",  200, Array(
        Array(1672039, 1)
    )),
    //Array("高級智能機器人(男)",  200, Array(
    //    Array(1662002, 1)
    //)),
    //Array("高級智能機器人(女)",  200, Array(
   //     Array(1662003, 1)
   // )),
    Array("真·覺醒冒險之心（自選）",  200, Array(
        Array(2431996, 1)
    )),
        Array("女武神之心", 600, Array(
        Array(1672069, 1)
    )),
    Array("稀有外星碎片頭盔",  300, Array(
        Array(1003893, 1)
    ))
   // Array("魯塔比斯魔法師套裝", 398, Array(
   //     Array(1003798, 1),
   //     Array(1042255, 1),
   //     Array(1062166, 1)
   // )),
   // Array("魯塔比斯弓箭手套裝", 398, Array(
   //    Array(1003799, 1),
   //     Array(1042256, 1),
   //     Array(1062167, 1)
    //)),
    //Array("魯塔比斯盜賊套裝", 398, Array(
   //     Array(1003800, 1),
   //     Array(1042257, 1),
   //     Array(1062168, 1)
   // )),
    //  Array("封印解除卷軸X10", 10, Array(
    //    Array(2610001, 10),
    //    Array(-1, 2500)
   // ))
    //Array("蠟筆禮包", 500, Array(
        //Array(3994417, 1),
        //Array(3994418, 1),
        //Array(3994419, 1),
        //Array(3994420, 1),
        //Array(3994421, 1),
        //Array(3994422, 1)
    //))
);
var giftId = -1;
var gifts = null;
var price = 999;
var column = new Array("裝備", "消耗", "設置", "其他", "商城");
function start() {
    status = -1;
    action(1, 0, 0);
}

function action(mode, type, selection) {
    if (status == 0 && mode == 0) {
        cm.dispose();
        return;
    }
    if (mode == 1) {
        status++;
    } else {
        status--;
    }
    if (status == 0) {
        var conn = cm.getConnection();
        var pstmt = conn.prepareStatement("select leiji from hypay where accname = '"+cm.getC().getAccountName()+"'");
        var result = pstmt.executeQuery();
        result.next();
        var revenue = result.getString("leiji");
        var text = "";
        text = ""+iconHR+"尊敬的玩家#b#h ##k，歡迎來到#b#e神豪商城，點擊可以查看禮包內容哦！#n#k\r\n";
        //text += "#e#b歡迎來到VIP商城，點擊可以查看禮包內容哦！\r\n";
        text += ""+icon2+"您當前餘額為：#r"+cm.getHyPay(1)+"#k "+"\t\t"+icon2+"累計儲值：#r"+revenue+"#k\r\n";
        for(var key in giftContent) {
            text+="#b#L"+key+"#購買【#r#e"+giftContent[key][0]+"#n#b】 #e#d需要"+giftContent[key][1]+"餘額#n#b#l#k\r\n";
        }
        cm.sendSimple(text);
    } else if (status == 1) {
        giftId = parseInt(selection);
        price = giftContent[giftId][1];
        gifts = giftContent[giftId][2];
        var text="#r#e"+giftContent[giftId][0]+"#n#b內容：\r\n";
        for(var key in gifts) {
            var itemId = gifts[key][0];
            var itemQuantity = gifts[key][1];
            text+="#i"+itemId+":##b" + (itemId == -1 ? "贈送樂豆點" : "#z" + itemId + "#") + "#k #rx "+itemQuantity+"#k\r\n";
        }
        text+="\r\n#d是否花費#e#r"+price+"#n#d餘額購買該禮包？#k";
        cm.sendYesNo(text);
    } else if (status == 2) {
        if (giftId!=-1 && gifts != null) {
            var needslot = new Array(0, 0, 0, 0, 0);
            for (var i in gifts) {
                var type = Math.floor(gifts[i][0] / 1000000);
                if (type == -1) {
                    continue;
                }
                needslot[type - 1] = needslot[type - 1] + 1;
            }
            for (var i = 0; i < 5; i++) {
                if (cm.getSpace(i + 1) < needslot[i]) {
                    cm.sendOk("您的" + column[i] + "欄位空間不足" + needslot[i] + "格，請清理後再來。");
                    cm.dispose();
                    return;
                }
            }
            if (cm.getHyPay(1) < price) {
                cm.sendOk("您的餘額不足，請先儲值後再購買。");
                cm.dispose();
                return ;
            }
            for(var key in gifts) {
                var itemId = gifts[key][0];
                var itemQuantity = gifts[key][1];
                if (itemId == -1) {
                    cm.gainNX(itemQuantity);
                } else {
                    cm.gainGachaponItem(itemId, itemQuantity,"神豪商城",3);
                }
            }
            cm.addHyPay(price);
            cm.sendOk("恭喜您，購買成功！");
            //cm.worldSpouseMessage(0x0F,"[VIP商城] VIP玩家 "+ cm.getChar().getName() +" 從商城裡掏走了價值"+price+"的["+giftContent[giftId][0]+"]裝備！！！");
            cm.dispose();
        } else {
            cm.sendOk("購買錯誤！請聯繫管理員！");
            cm.dispose();
        }
    }
}